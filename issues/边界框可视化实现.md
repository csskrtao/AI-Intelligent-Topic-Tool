# è¾¹ç•Œæ¡†å¯è§†åŒ–å®ç°

## ğŸ“… å®ç°æ—¶é—´
2025-11-07

## ğŸ¯ å®ç°ç›®æ ‡
åœ¨å‰ç«¯ç•Œé¢ä¸Šå¯è§†åŒ–æ˜¾ç¤ºé¢˜ç›®çš„è‡ªåŠ¨åˆ†å‰²ç»“æœï¼Œä½¿ç”¨ Canvas ç»˜åˆ¶è¾¹ç•Œæ¡†ã€‚

## âœ… å·²å®ŒæˆåŠŸèƒ½

### 1. åç«¯ä¿®æ”¹

#### 1.1 ä¿®æ”¹ QuestionResponse æ¨¡å‹
**æ–‡ä»¶**: `backend_api.py`

```python
class QuestionResponse(BaseModel):
    """é¢˜ç›®å“åº”æ¨¡å‹"""
    question_id: int
    text: str
    has_bounding_box: bool
    bounding_box: Optional[Dict[str, float]] = None  # è¾¹ç•Œæ¡†åæ ‡ {x1, y1, x2, y2}
```

#### 1.2 æ”¹ç”¨ split_ocr_result æ–¹æ³•
**æ–‡ä»¶**: `backend_api.py`

```python
# åˆ†å‰²é¢˜ç›®ï¼ˆä½¿ç”¨ OCR ç»“æœè¿›è¡Œåˆ†å‰²ï¼Œä¿ç•™è¾¹ç•Œæ¡†åæ ‡ï¼‰
questions = question_splitter.split_ocr_result(ocr_result)

# æ„é€ å“åº”
question_responses = [
    QuestionResponse(
        question_id=q.question_id,
        text=q.text,
        has_bounding_box=q.bounding_box is not None,
        bounding_box={
            'x1': q.bounding_box.x1,
            'y1': q.bounding_box.y1,
            'x2': q.bounding_box.x2,
            'y2': q.bounding_box.y2
        } if q.bounding_box else None
    )
    for q in questions
]
```

### 2. å‰ç«¯ç»„ä»¶å¼€å‘

#### 2.1 BoundingBoxCanvas ç»„ä»¶
**æ–‡ä»¶**: `src/components/BoundingBoxCanvas.jsx`

**åŠŸèƒ½**:
- âœ… ä½¿ç”¨ HTML5 Canvas ç»˜åˆ¶è¾¹ç•Œæ¡†
- âœ… ç»˜åˆ¶é¢˜å·æ ‡ç­¾ï¼ˆæ˜¾ç¤ºåœ¨è¾¹ç•Œæ¡†å·¦ä¸Šè§’ï¼‰
- âœ… æ”¯æŒ 8 ç§é¢œè‰²å¾ªç¯ä½¿ç”¨ï¼ŒåŒºåˆ†ä¸åŒé¢˜ç›®
- âœ… é¼ æ ‡æ‚¬åœé«˜äº®æ•ˆæœï¼ˆè¾¹æ¡†åŠ ç²—ã€åŠé€æ˜å¡«å……ï¼‰
- âœ… é¼ æ ‡æ‚¬åœæ—¶æ”¹å˜å…‰æ ‡æ ·å¼
- âœ… å®æ—¶å“åº” questionsã€imageSizeã€hoveredQuestionId å˜åŒ–

**é¢œè‰²æ–¹æ¡ˆ**:
```javascript
const colors = [
  '#1890ff', // è“è‰²
  '#52c41a', // ç»¿è‰²
  '#faad14', // æ©™è‰²
  '#f5222d', // çº¢è‰²
  '#722ed1', // ç´«è‰²
  '#13c2c2', // é’è‰²
  '#eb2f96', // ç²‰è‰²
  '#fa8c16', // æ©™çº¢è‰²
];
```

#### 2.2 ImageViewer ç»„ä»¶ä¿®æ”¹
**æ–‡ä»¶**: `src/components/ImageViewer.jsx`

**ä¿®æ”¹å†…å®¹**:
- âœ… æ·»åŠ  `questions`ã€`selectedQuestionId`ã€`onQuestionHover` props
- âœ… ä½¿ç”¨ `useRef` è·å–å›¾ç‰‡å¼•ç”¨
- âœ… åœ¨å›¾ç‰‡åŠ è½½å®Œæˆåè·å–å›¾ç‰‡å®é™…å°ºå¯¸ï¼ˆnaturalWidth, naturalHeightï¼‰
- âœ… ä½¿ç”¨ç›¸å¯¹å®šä½å®¹å™¨åŒ…è£¹å›¾ç‰‡å’Œ Canvas
- âœ… é›†æˆ BoundingBoxCanvas ç»„ä»¶
- âœ… åœ¨æ ‡é¢˜ä¸­æ˜¾ç¤ºè¾¹ç•Œæ¡†æ•°é‡

#### 2.3 PreviewPanel ç»„ä»¶ä¿®æ”¹
**æ–‡ä»¶**: `src/components/PreviewPanel.jsx`

**ä¿®æ”¹å†…å®¹**:
- âœ… æ·»åŠ  `hoveredQuestionId` çŠ¶æ€
- âœ… å°† `questions` ä¼ é€’ç»™ ImageViewer
- âœ… å°† `hoveredQuestionId` ä¼ é€’ç»™ QuestionList å®ç°è”åŠ¨é«˜äº®

#### 2.4 QuestionList ç»„ä»¶ä¿®æ”¹
**æ–‡ä»¶**: `src/components/QuestionList.jsx`

**ä¿®æ”¹å†…å®¹**:
- âœ… æ·»åŠ  `hoveredQuestionId` prop
- âœ… ä¸ºæ‚¬åœçš„é¢˜ç›®æ·»åŠ  `hovered` CSS ç±»
- âœ… æ·»åŠ æ‚¬åœæ ·å¼ï¼ˆæ©™è‰²èƒŒæ™¯ã€é˜´å½±æ•ˆæœï¼‰

## ğŸ¨ è§†è§‰æ•ˆæœ

### è¾¹ç•Œæ¡†æ ·å¼
- **æ­£å¸¸çŠ¶æ€**: 2px è¾¹æ¡†ï¼Œå¯¹åº”é¢œè‰²
- **æ‚¬åœ/é€‰ä¸­çŠ¶æ€**: 4px è¾¹æ¡†ï¼ŒåŠé€æ˜å¡«å……

### é¢˜å·æ ‡ç­¾
- **ä½ç½®**: è¾¹ç•Œæ¡†å·¦ä¸Šè§’
- **èƒŒæ™¯**: ä¸è¾¹æ¡†åŒè‰²ï¼Œä¸é€æ˜
- **æ–‡å­—**: ç™½è‰²ï¼ŒåŠ ç²—
- **å­—ä½“å¤§å°**: æ­£å¸¸ 14pxï¼Œé«˜äº® 16px

### äº¤äº’æ•ˆæœ
- **Canvas æ‚¬åœ**: å…‰æ ‡å˜ä¸º pointer
- **é¢˜ç›®åˆ—è¡¨è”åŠ¨**: æ‚¬åœè¾¹ç•Œæ¡†æ—¶ï¼Œå¯¹åº”é¢˜ç›®é«˜äº®æ˜¾ç¤ºï¼ˆæ©™è‰²èƒŒæ™¯ï¼‰

## ğŸ”§ æŠ€æœ¯è¦ç‚¹

### 1. åæ ‡ç³»ç»Ÿ
- åç«¯è¿”å›çš„æ˜¯å›¾ç‰‡åŸå§‹åƒç´ åæ ‡
- Canvas å°ºå¯¸è®¾ç½®ä¸ºå›¾ç‰‡çš„ naturalWidth å’Œ naturalHeight
- æ— éœ€è¿›è¡Œåæ ‡ç¼©æ”¾è½¬æ¢

### 2. Canvas åŒæ­¥
- ä½¿ç”¨ `useEffect` ç›‘å¬ questionsã€imageSizeã€hoveredQuestionId å˜åŒ–
- è‡ªåŠ¨é‡æ–°ç»˜åˆ¶ Canvas

### 3. æ€§èƒ½ä¼˜åŒ–
- ä»…åœ¨å¿…è¦æ—¶é‡ç»˜ Canvas
- ä½¿ç”¨ Canvas åŸç”Ÿ APIï¼Œæ€§èƒ½ä¼˜å¼‚

## ğŸ“ æµ‹è¯•è®¡åˆ’

### æµ‹è¯•é¡¹ç›®
1. âœ… åç«¯ API è¿”å›è¾¹ç•Œæ¡†åæ ‡
2. âœ… å‰ç«¯æ¥æ”¶å¹¶è§£æè¾¹ç•Œæ¡†æ•°æ®
3. âœ… Canvas æ­£ç¡®ç»˜åˆ¶è¾¹ç•Œæ¡†
4. âœ… è¾¹ç•Œæ¡†ä½ç½®å‡†ç¡®
5. âœ… é¢˜å·æ ‡ç­¾æ˜¾ç¤ºæ­£ç¡®
6. âœ… æ‚¬åœé«˜äº®æ•ˆæœæ­£å¸¸
7. âœ… é¢˜ç›®åˆ—è¡¨è”åŠ¨é«˜äº®
8. âœ… ä¸åŒå°ºå¯¸å›¾ç‰‡é€‚é…

### æµ‹è¯•æ­¥éª¤
1. å¯åŠ¨åç«¯æœåŠ¡
2. å¯åŠ¨å‰ç«¯æœåŠ¡
3. ä¸Šä¼ æµ‹è¯•å›¾ç‰‡
4. éªŒè¯è¾¹ç•Œæ¡†æ˜¾ç¤º
5. æµ‹è¯•æ‚¬åœäº¤äº’

## ğŸš€ ä¸‹ä¸€æ­¥ä¼˜åŒ–å»ºè®®

1. **ç‚¹å‡»é€‰æ‹©**: ç‚¹å‡»è¾¹ç•Œæ¡†è‡ªåŠ¨é€‰ä¸­å¯¹åº”é¢˜ç›®
2. **è¾¹ç•Œæ¡†ç¼–è¾‘**: æ”¯æŒæ‹–æ‹½è°ƒæ•´è¾¹ç•Œæ¡†å¤§å°
3. **ç¼©æ”¾æ”¯æŒ**: æ”¯æŒå›¾ç‰‡ç¼©æ”¾æ—¶è¾¹ç•Œæ¡†åŒæ­¥ç¼©æ”¾
4. **å¯¼å‡ºé¢„è§ˆ**: å¯¼å‡ºå‰é¢„è§ˆè£å‰ªæ•ˆæœ

